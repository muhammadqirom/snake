<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Snake Neon Pro - Admin Edition</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
    <style>
        :root {
            --primary: #00ff88;
            --secondary: #00d4ff;
            --accent: #ff00ff;
            --danger: #ff4d4d;
            --bg: #030712;
            --card: #111827;
            --border: #374151;
        }

        body { 
            font-family: 'Poppins', sans-serif; 
            background: var(--bg); color: white; margin: 0; 
            overflow: hidden; display: flex; flex-direction: column; height: 100vh;
        }

        /* UI Overlays */
        .overlay {
            position: fixed; inset: 0; background: rgba(3, 7, 18, 0.95);
            display: flex; justify-content: center; align-items: center;
            z-index: 1000; backdrop-filter: blur(10px);
        }

        .modal-box {
            background: var(--card); padding: 25px; border-radius: 24px;
            border: 1px solid var(--border); text-align: center; width: 85%; max-width: 340px;
        }

        input {
            width: 100%; padding: 12px; margin: 10px 0; background: #1f2937;
            border: 1px solid var(--border); color: white; border-radius: 12px; text-align: center;
        }

        .btn-main {
            background: linear-gradient(135deg, var(--secondary), var(--accent));
            color: white; border: none; padding: 12px; border-radius: 12px;
            font-weight: bold; width: 100%; cursor: pointer; margin: 5px 0;
        }

        /* Game HUD */
        #game-hud {
            display: none; position: absolute; top: 15px; left: 50%;
            transform: translateX(-50%); background: rgba(17, 24, 39, 0.85);
            padding: 8px 25px; border-radius: 20px; border: 2px solid var(--secondary);
            text-align: center; z-index: 500; pointer-events: none;
        }

        /* Game Elements */
        #game-container { flex: 1; display: flex; flex-direction: column; align-items: center; padding: 10px; }
        canvas { 
            background: #000; border: 3px solid var(--border); border-radius: 10px;
            max-width: 95vw; max-height: 50vh; box-shadow: 0 0 20px rgba(0,212,255,0.2);
        }

        #menu {
            position: absolute; inset: 0; background: var(--bg);
            display: flex; flex-direction: column; align-items: center;
            z-index: 100; overflow-y: auto; padding: 20px 0;
        }

        .menu-item {
            width: 280px; padding: 15px; background: #1f2937; margin: 5px;
            border-radius: 12px; border: 1px solid var(--border); text-align: center; font-weight: bold;
        }

        /* Album & Crop */
        .album-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 10px; }
        .album-item { width: 100%; aspect-ratio: 1; object-fit: cover; border-radius: 8px; border: 1px solid var(--border); }
        #crop-modal { display: none; position: fixed; inset: 0; background: #000; z-index: 5000; flex-direction: column; align-items: center; justify-content: center; }
        .crop-container { width: 90%; max-width: 400px; height: 400px; background: #111; margin-bottom: 20px; }

        #controls { padding: 100px; display: none; }
        .dpad { display: grid; grid-template-columns: repeat(3, 65px); gap: 10px; justify-content: center; }
        .dpad button { width: 65px; height: 65px; background: #1f2937; color: white; border-radius: 15px; border: 1px solid var(--border); font-size: 20px; }
        
        .rank-row { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid var(--border); }
        canvas { 
    background: #000; 
    border: 3px solid var(--border); 
    border-radius: 10px;
    max-width: 95vw; 
    max-height: 50vh; 
    box-shadow: 0 0 20px rgba(0,212,255,0.2);
    
    /* TAMBAHKAN INI */
    margin-top: 67px; /* Ubah angka ini untuk mengatur seberapa jauh turunnya */
}

    </style>
</head>
<body>

    <div id="game-hud">
        <span style="font-size: 10px; color: var(--secondary); font-weight: bold; display: block;">SCORE</span>
        <span id="live-score" style="font-size: 28px; font-weight: 900;">0</span>
    </div>

    <div id="login-overlay" class="overlay">
        <div class="modal-box">
            <h2 style="color:var(--primary)">SNAKE PRO LOGIN</h2>
            <input type="text" id="username-input" placeholder="USERNAME" maxlength="10">
            <input type="password" id="password-input" placeholder="PASSWORD" maxlength="10">
            <button class="btn-main" onclick="confirmLogin()">MASUK / DAFTAR</button>
        </div>
    </div>

    <div id="game-container">
        <div id="menu" style="display:none">
            <div style="text-align: center; margin-bottom: 20px;">
                <div style="position: relative; display: inline-block;">
                    <img id="profile-img" src="https://via.placeholder.com/80" style="width: 80px; height: 80px; border-radius: 50%; border: 3px solid var(--primary); object-fit: cover;">
                    <input type="file" id="upload-photo" hidden accept="image/*">
                    <button onclick="document.getElementById('upload-photo').click()" style="position: absolute; bottom: 0; right: 0; background: var(--primary); border: none; border-radius: 50%; width: 24px; height: 24px; color: white;">+</button>
                </div>
                <h3 id="profile-name">Player</h3>
                <div id="coin-info" style="color: #fbbf24; font-weight: bold;">ðŸª™ 0</div>
            </div>

            <div id="main-menu-list">
                <div class="menu-item" style="border-left: 5px solid var(--primary)" onclick="startGame()">MULAI BERMAIN</div>
                <div class="menu-item" style="border-left: 5px solid var(--secondary)" onclick="showLeaderboard()">HALL OF FAME</div>
                <div class="menu-item" style="border-left: 5px solid var(--accent)" onclick="showSkins()">SKIN SHOP</div>
                <div class="menu-item" style="color:var(--danger)" onclick="location.reload()">LOGOUT</div>
            </div>
        </div>

        <canvas id="gameCanvas" width="600" height="600"></canvas>
    </div>

    <div id="controls">
        <div class="dpad">
            <button style="grid-column:2" onclick="changeDirection(0, -1)">â–²</button>
            <button style="grid-column:1" onclick="changeDirection(-1, 0)">â—€</button>
            <button style="grid-column:2" onclick="changeDirection(0, 1)">â–¼</button>
            <button style="grid-column:3" onclick="changeDirection(1, 0)">â–¶</button>
        </div>
    </div>

    <div id="gameover-overlay" class="overlay" style="display:none">
        <div class="modal-box" style="border-color: var(--danger)">
            <h2 style="color:var(--danger)">GAME OVER</h2>
            <h1 id="final-score">0</h1>
            <button class="btn-main" onclick="startGame()">COBA LAGI</button>
            <button class="btn-main" style="background:#374151" onclick="backToMenu()">KEMBALI</button>
        </div>
    </div>

    <div id="crop-modal">
        <div class="crop-container"><img id="image-to-crop"></div>
        <button class="btn-main" style="width:200px" onclick="executeCrop()">POTONG & SIMPAN</button>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const blockSize = 20; // Ukuran diperkecil agar map terasa luas
        let snake, direction, food, score, gameRunning = false, gameInterval;
        let currentUser = "";
        let accountData = { coins: 0, currentSkin: 'Classic', unlockedSkins: ['Classic'], highScore: 0, role: 'player' };

        const skins = {
            Classic: { color: '#00ff88', price: 0 },
            Electric: { color: '#00d4ff', price: 0 },
            Lava: { color: '#ff4d4d', price: 0 },
            Rainbow: { color: 'rainbow', price: 0 }
        };

        function confirmLogin() {
            const userVal = document.getElementById('username-input').value.trim().toUpperCase();
            const passVal = document.getElementById('password-input').value.trim();
            if(!userVal || !passVal) return alert("Isi nama & password!");

            currentUser = userVal;
            const saved = localStorage.getItem(`snake_pro_${currentUser}`);

            if(saved) {
                const data = JSON.parse(saved);
                if(data.password !== passVal) return alert("Password Salah!");
                accountData = data;
            } else {
                // PENDAFTARAN ADMIN VEDORA
                if(userVal === "VEDOR" && passVal === "DEKU") {
                    accountData = { password: passVal, coins: 999999, currentSkin: 'Rainbow', unlockedSkins: Object.keys(skins), highScore: 0, role: 'admin' };
                } else {
                    accountData = { password: passVal, coins: 0, currentSkin: 'Classic', unlockedSkins: ['Classic'], highScore: 0, role: 'player' };
                }
                localStorage.setItem(`snake_pro_${currentUser}`, JSON.stringify(accountData));
            }

            document.getElementById('login-overlay').style.display = 'none';
            document.getElementById('menu').style.display = 'flex';
            document.getElementById('profile-name').innerText = currentUser;
            const av = localStorage.getItem(`avatar_${currentUser}`);
            if(av) document.getElementById('profile-img').src = av;
            updateUI();
        }

        function updateUI() {
            document.getElementById('coin-info').innerText = `ðŸª™ ${accountData.coins}`;
            localStorage.setItem(`snake_pro_${currentUser}`, JSON.stringify(accountData));
        }

        function startGame() {
            document.getElementById('menu').style.display = 'none';
            document.getElementById('gameover-overlay').style.display = 'none';
            document.getElementById('controls').style.display = 'block';
            document.getElementById('game-hud').style.display = 'block';
            
            score = 0;
            document.getElementById('live-score').innerText = "0";
            snake = [{x: 300, y: 300}, {x: 290, y: 300}];
            direction = {x: blockSize, y: 0};
            spawnFood();
            gameRunning = true;
            if(gameInterval) clearInterval(gameInterval);
            gameInterval = setInterval(gameLoop, 80);
        }

        function spawnFood() {
            food = {
                x: Math.floor(Math.random() * (canvas.width / blockSize)) * blockSize,
                y: Math.floor(Math.random() * (canvas.height / blockSize)) * blockSize
            };
        }

        function gameLoop() {
            if(!gameRunning) return;
            const head = {x: snake[0].x + direction.x, y: snake[0].y + direction.y};

            if(head.x < 0 || head.x >= canvas.width || head.y < 0 || head.y >= canvas.height || 
               snake.some(s => s.x === head.x && s.y === head.y)) return gameOver();

            snake.unshift(head);
            if(head.x === food.x && head.y === food.y) {
                score += 10;
                accountData.coins += 5;
                document.getElementById('live-score').innerText = score;
                updateUI();
                spawnFood();
            } else { snake.pop(); }
            draw();
        }

        function draw() {
            ctx.fillStyle = '#05070a';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Food
            ctx.fillStyle = '#ff3131';
            ctx.beginPath();
            ctx.arc(food.x + 10, food.y + 10, 8, 0, Math.PI * 2);
            ctx.fill();

            // Snake
            const skin = skins[accountData.currentSkin];
            snake.forEach((s, i) => {
                ctx.fillStyle = i === 0 ? '#fff' : (skin.color === 'rainbow' ? `hsl(${(i*20)%360},100%,50%)` : skin.color);
                ctx.fillRect(s.x + 1, s.y + 1, blockSize - 2, blockSize - 2);
            });
        }

        function changeDirection(x, y) {
            const n = {x: x * blockSize, y: y * blockSize};
            if(n.x !== -direction.x && n.y !== -direction.y) direction = n;
        }

        function gameOver() {
            gameRunning = false;
            clearInterval(gameInterval);
            document.getElementById('game-hud').style.display = 'none';
            document.getElementById('final-score').innerText = score;
            document.getElementById('gameover-overlay').style.display = 'flex';
            saveLeaderboard();
        }

        function saveLeaderboard() {
            let lb = JSON.parse(localStorage.getItem('snake_pro_lb')) || [];
            const idx = lb.findIndex(e => e.name === currentUser);
            if(idx !== -1) {
                if(score > lb[idx].score) lb[idx].score = score;
            } else { lb.push({name: currentUser, score: score}); }
            localStorage.setItem('snake_pro_lb', JSON.stringify(lb));
        }

        function showLeaderboard() {
            const list = JSON.parse(localStorage.getItem('snake_pro_lb')) || [];
            list.sort((a,b) => b.score - a.score);
            let html = '<h2>TOP RANK</h2>';
            list.slice(0,10).forEach((item, i) => {
                let del = (accountData.role === 'admin' && item.name !== currentUser) ? 
                    `<button onclick="adminDeletePlayer('${item.name}')" style="background:red; color:white; border:none; padding:2px 8px; border-radius:5px;">HAPUS</button>` : '';
                html += `<div class="rank-row"><span>#${i+1} ${item.name}</span><span>${item.score} ${del}</span></div>`;
            });
            html += `<button class="btn-main" onclick="backToMenu()">KEMBALI</button>`;
            document.getElementById('main-menu-list').innerHTML = html;
        }

        function adminDeletePlayer(name) {
            if(confirm(`Hapus ${name}?`)) {
                let lb = JSON.parse(localStorage.getItem('snake_pro_lb')) || [];
                localStorage.setItem('snake_pro_lb', JSON.stringify(lb.filter(p => p.name !== name)));
                localStorage.removeItem(`snake_pro_${name}`);
                alert("Terhapus!");
                showLeaderboard();
            }
        }

        function showSkins() {
            let html = '<h2>SKIN SHOP</h2>';
            for(let s in skins) {
                const owned = accountData.unlockedSkins.includes(s);
                html += `<div class="menu-item" onclick="buySkin('${s}')">${s} ${owned ? '(MILIK)' : 'ðŸª™'+skins[s].price}</div>`;
            }
            html += `<button class="btn-main" onclick="backToMenu()">KEMBALI</button>`;
            document.getElementById('main-menu-list').innerHTML = html;
        }

        function buySkin(s) {
            if(accountData.unlockedSkins.includes(s)) {
                accountData.currentSkin = s;
                alert("Skin Digunakan!");
            } else if(accountData.coins >= skins[s].price) {
                accountData.coins -= skins[s].price;
                accountData.unlockedSkins.push(s);
                accountData.currentSkin = s;
                alert("Berhasil Membeli!");
            }
            updateUI();
            showSkins();
        }

        function backToMenu() {
            document.getElementById('gameover-overlay').style.display = 'none';
            document.getElementById('controls').style.display = 'none';
            document.getElementById('menu').style.display = 'flex';
            document.getElementById('main-menu-list').innerHTML = `
                <div class="menu-item" style="border-left: 5px solid var(--primary)" onclick="startGame()">MULAI BERMAIN</div>
                <div class="menu-item" style="border-left: 5px solid var(--secondary)" onclick="showLeaderboard()">HALL OF FAME</div>
                <div class="menu-item" style="border-left: 5px solid var(--accent)" onclick="showSkins()">SKIN SHOP</div>
                <div class="menu-item" style="color:var(--danger)" onclick="location.reload()">LOGOUT</div>
            `;
        }

        // --- CROPPER LOGIC ---
        let cropper;
        document.getElementById('upload-photo').addEventListener('change', function(e) {
            const reader = new FileReader();
            reader.onload = function(event) {
                document.getElementById('image-to-crop').src = event.target.result;
                document.getElementById('crop-modal').style.display = 'flex';
                if(cropper) cropper.destroy();
                cropper = new Cropper(document.getElementById('image-to-crop'), { aspectRatio: 1 });
            };
            reader.readAsDataURL(e.target.files[0]);
        });

        function executeCrop() {
            const cropped = cropper.getCroppedCanvas({width:200, height:200}).toDataURL();
            document.getElementById('profile-img').src = cropped;
            localStorage.setItem(`avatar_${currentUser}`, cropped);
            document.getElementById('crop-modal').style.display = 'none';
        }
    </script>
</body>
</html>
